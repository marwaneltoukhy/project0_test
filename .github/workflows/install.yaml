name: project0
# either manually started, or on a schedule
on: push
jobs:
  install:
    # ubuntu
    runs-on: ubuntu-latest
    steps:

#    # magic dependency
#    - name: install magic
#      run: >
#        sudo apt-get install -y tcsh csh tcl-dev tk-dev libcairo2-dev;
#        git clone git://opencircuitdesign.com/magic;
#        cd magic;
#        git checkout 8.3.209;
#        ./configure;
#        make;
#        sudo make install;
#
#    # test
#    - name: test magic
#      run: magic --version
#
#    - name: docker
#      run: sudo apt-get install -y docker.io
#
    - name: caravel_user_project
      env:
        PDK_ROOT: $(pwd)/pdk
        OPENLANE_ROOT: $(pwd)/openlane
        SKYWATER_COMMIT: c094b6e83a4f9298e47f696ec5a7fd53535ec5eb
        OPEN_PDKS_COMMIT: 14db32aa8ba330e88632ff3ad2ff52f4f4dae1ad
        OPENLANE_TAG: mpw-3a
        OPENLANE_IMAGE_NAME: efabless/openlane:$OPENLANE_TAG

      run: >
        echo $PDK_ROOT;
        echo $OPENLANE_ROOT;
        echo $OPENLANE_IMAGE_NAME;
        git clone https://github.com/efabless/caravel_user_project.git;
        cd caravel_user_project;
        git checkout mpw-3;
        export CARAVEL_ROOT=$(pwd)/caravel;
        make install;
        cd caravel;
        git log;
        cd ..;
        make pdk;
        make openlane;
        make user_proj_example;
